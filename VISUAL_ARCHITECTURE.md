# ğŸ¨ VISUAL SYSTEM ARCHITECTURE

## Complete System Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         GRIDEE PARKING SYSTEM                      â”ƒ
â”ƒ                    Role-Based Authentication Flow                   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Mobile App    â”‚
                          â”‚  (Android/iOS)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ User enters credentials
                                   â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    LOGIN SCREEN          â”‚
                     â”‚  [Email/Phone]           â”‚
                     â”‚  [Password]              â”‚
                     â”‚  [Sign In Button]        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ POST /api/auth/login
                                  â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                        BACKEND (Spring Boot)                        â”ƒ
â”ƒ                                                                     â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ
â”ƒ  â”‚  AuthController.login()                                       â”‚ â”ƒ
â”ƒ  â”‚  1. Validate credentials                                      â”‚ â”ƒ
â”ƒ  â”‚  2. Load user from database                                   â”‚ â”ƒ
â”ƒ  â”‚  3. Generate JWT token                                        â”‚ â”ƒ
â”ƒ  â”‚     - userId                                                  â”‚ â”ƒ
â”ƒ  â”‚     - name, email, phone                                      â”‚ â”ƒ
â”ƒ  â”‚     - role: "USER" or "OPERATOR" â—„â”€â”€ KEY FIELD                â”‚ â”ƒ
â”ƒ  â”‚  4. Return AuthResponse                                       â”‚ â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                  â”‚
                                  â”‚ JWT Token with role
                                  â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   Android App            â”‚
                     â”‚   Parse JWT response     â”‚
                     â”‚   Check: authResponse.roleâ”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                    â”‚
        role == "USER"                      role == "OPERATOR"
                â”‚                                    â”‚
                â–¼                                    â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ   USER FLOW             â”ƒ        â”ƒ   OPERATOR FLOW           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›        â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MainContainerActivity â”‚          â”‚ OperatorDashboardActivity  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚          â”‚                            â”‚
â”‚ ğŸ  Home               â”‚          â”‚ ğŸ‘¤ Operator: John Doe      â”‚
â”‚ ğŸ” Search Parking     â”‚          â”‚ ğŸ“ Location: Parking Lot A â”‚
â”‚ ğŸ“… My Bookings        â”‚          â”‚                            â”‚
â”‚ ğŸ’³ Wallet             â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ âš™ï¸  Settings          â”‚          â”‚ â”‚ ğŸš— CHECK-IN            â”‚ â”‚
â”‚                       â”‚          â”‚ â”‚                        â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
        â”‚                          â”‚ â”‚  â”‚ ğŸ“· Scan Vehicle  â”‚ â”‚ â”‚
        â”‚ User selects booking     â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
        â–¼                          â”‚ â”‚        OR              â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚  [Enter: ABC123__]    â”‚ â”‚
â”‚ Booking Details       â”‚          â”‚ â”‚  [âœ“ Manual Check-In]  â”‚ â”‚
â”‚                       â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Vehicle: ABC123       â”‚          â”‚                            â”‚
â”‚ Slot: A12             â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Time: 10:00-12:00     â”‚          â”‚ â”‚ ğŸš™ CHECK-OUT           â”‚ â”‚
â”‚                       â”‚          â”‚ â”‚                        â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚ â”‚  [ğŸ“· Scan for Checkout]â”‚ â”‚
â”‚ â”‚ âï¸  CHECK IN      â”‚ â”‚          â”‚ â”‚  [âœ— Manual Checkout]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
            â”‚                                   â”‚
            â”‚ User taps "Check In"              â”‚ Operator scans plate
            â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QR Scanner Opens      â”‚          â”‚ Camera Scanner Opens       â”‚
â”‚                       â”‚          â”‚                            â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚          â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚   â•‘               â•‘   â”‚          â”‚   â•‘                      â•‘ â”‚
â”‚   â•‘   [QR CODE]   â•‘   â”‚          â”‚   â•‘   ABC  123           â•‘ â”‚
â”‚   â•‘               â•‘   â”‚          â”‚   â•‘   â–”â–”â–”â–”â–”â–”â–”â–”           â•‘ â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚          â”‚   â•‘  (License Plate)     â•‘ â”‚
â”‚                       â”‚          â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ QR scanned                             â”‚ Plate extracted
        â–¼                                        â–¼
        
        POST /api/bookings/            POST /api/bookings/
        {userId}/checkin/{bookingId}   checkin
        
        Body:                          Body:
        {                              {
          "mode": "QR_CODE",             "mode": "VEHICLE_NUMBER",
          "qrCode": "xyz..."             "vehicleNumber": "ABC123"
        }                              }
        
        Auth:                          Auth:
        Bearer <JWT with role=USER>    Bearer <JWT with role=OPERATOR>
        
        â”‚                              â”‚
        â–¼                              â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    BACKEND API ENDPOINTS                           â”ƒ
â”ƒ                                                                    â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚ USER Endpoint               â”‚  â”‚ OPERATOR Endpoint         â”‚  â”ƒ
â”ƒ  â”‚ @PreAuthorize("ROLE_USER")  â”‚  â”‚ @PreAuthorize("OPERATOR") â”‚  â”ƒ
â”ƒ  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”ƒ
â”ƒ  â”‚ checkInWithBookingId()      â”‚  â”‚ checkIn()                 â”‚  â”ƒ
â”ƒ  â”‚                             â”‚  â”‚                           â”‚  â”ƒ
â”ƒ  â”‚ 1. Verify booking exists    â”‚  â”‚ 1. Find booking by        â”‚  â”ƒ
â”ƒ  â”‚ 2. Check user owns booking  â”‚  â”‚    vehicleNumber          â”‚  â”ƒ
â”ƒ  â”‚ 3. Validate QR code         â”‚  â”‚ 2. No ownership check     â”‚  â”ƒ
â”ƒ  â”‚ 4. Set checkInTime = now    â”‚  â”‚ 3. Set checkInTime = now  â”‚  â”ƒ
â”ƒ  â”‚ 5. Return booking           â”‚  â”‚ 4. Set operatorId         â”‚  â”ƒ
â”ƒ  â”‚                             â”‚  â”‚ 5. Return booking         â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
        â”‚                              â”‚
        â”‚ Success Response             â”‚ Success Response
        â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Check-In Success   â”‚          â”‚ âœ… Check-In Success        â”‚
â”‚                       â”‚          â”‚                            â”‚
â”‚ Vehicle: ABC123       â”‚          â”‚ Vehicle: ABC123            â”‚
â”‚ Slot: A12             â”‚          â”‚ Slot: A12                  â”‚
â”‚ Time: 10:30 AM        â”‚          â”‚ Time: 10:30 AM             â”‚
â”‚                       â”‚          â”‚ Operator: John Doe         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Comparison

### USER Flow
```
User â†’ Login â†’ MainContainerActivity
  â†“
Select Booking â†’ View Details
  â†“
Tap Check-In â†’ Open QR Scanner
  â†“
Scan QR Code â†’ Extract bookingId
  â†“
API: POST /bookings/{userId}/checkin/{bookingId}
  â†“
Backend: Validate ownership + QR + update booking
  â†“
Return: Updated booking with checkInTime
  â†“
Show: Success message
```

### OPERATOR Flow
```
Operator â†’ Login â†’ OperatorDashboardActivity
  â†“
Tap Scan Vehicle â†’ Open Camera
  â†“
Scan License Plate â†’ Extract "ABC123"
  â†“
API: POST /bookings/checkin
Body: { vehicleNumber: "ABC123" }
  â†“
Backend: Find booking by plate + update
  â†“
Return: Updated booking with checkInTime + operatorId
  â†“
Show: Success message with details
```

---

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT TOKEN STRUCTURE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Header:                                                  â”‚
â”‚    { "alg": "HS256", "typ": "JWT" }                       â”‚
â”‚                                                           â”‚
â”‚  Payload:                                                 â”‚
â”‚    {                                                      â”‚
â”‚      "sub": "user_id_12345",                             â”‚
â”‚      "name": "John Doe",                                  â”‚
â”‚      "email": "john@example.com",                         â”‚
â”‚      "role": "OPERATOR",  â—„â”€â”€â”€ CRITICAL FIELD            â”‚
â”‚      "iat": 1234567890,                                   â”‚
â”‚      "exp": 1234571490                                    â”‚
â”‚    }                                                      â”‚
â”‚                                                           â”‚
â”‚  Signature:                                               â”‚
â”‚    HMACSHA256(base64UrlEncode(header) + "." +            â”‚
â”‚                base64UrlEncode(payload), secret)          â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Spring Security validates:       â”‚
        â”‚   1. Token signature valid?        â”‚
        â”‚   2. Token not expired?            â”‚
        â”‚   3. Role matches @PreAuthorize?   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USERS TABLE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚ VARCHAR(36)     â”‚ PRIMARY KEY            â”‚
â”‚ name        â”‚ VARCHAR(255)    â”‚                        â”‚
â”‚ email       â”‚ VARCHAR(255)    â”‚ UNIQUE                 â”‚
â”‚ phone       â”‚ VARCHAR(20)     â”‚                        â”‚
â”‚ password    â”‚ VARCHAR(255)    â”‚ (hashed)               â”‚
â”‚ role        â”‚ VARCHAR(20)     â”‚ "USER" or "OPERATOR" â—„â”€â”€â”
â”‚ created_at  â”‚ TIMESTAMP       â”‚                        â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                            â”‚
                                                    CRITICAL FIELD
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BOOKINGS TABLE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚ VARCHAR(36)   â”‚ PRIMARY KEY          â”‚
â”‚ user_id         â”‚ VARCHAR(36)   â”‚ FK â†’ users.id        â”‚
â”‚ vehicle_number  â”‚ VARCHAR(20)   â”‚                      â”‚
â”‚ parking_lot_id  â”‚ VARCHAR(36)   â”‚                      â”‚
â”‚ slot_id         â”‚ VARCHAR(10)   â”‚                      â”‚
â”‚ start_time      â”‚ TIMESTAMP     â”‚                      â”‚
â”‚ end_time        â”‚ TIMESTAMP     â”‚                      â”‚
â”‚ check_in_time   â”‚ TIMESTAMP     â”‚ NULL (until check-in)â”‚
â”‚ check_out_time  â”‚ TIMESTAMP     â”‚ NULL (until checkout)â”‚
â”‚ check_in_mode   â”‚ VARCHAR(20)   â”‚ QR_CODE | VEHICLE... â”‚
â”‚ operator_id     â”‚ VARCHAR(36)   â”‚ FK â†’ users.id        â”‚
â”‚ status          â”‚ VARCHAR(20)   â”‚ CONFIRMED | ACTIVE...â”‚
â”‚ total_amount    â”‚ DECIMAL(10,2) â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System States

```
BOOKING LIFECYCLE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CREATED     â”‚  User books parking
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIRMED   â”‚  Payment successful
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â”‚ USER:                       â”‚ OPERATOR:
       â”‚ Scans QR                    â”‚ Scans vehicle plate
       â”‚                             â”‚
       â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHECKED_IN  â”‚              â”‚  CHECKED_IN  â”‚
â”‚              â”‚              â”‚              â”‚
â”‚ + checkInTimeâ”‚              â”‚ + checkInTimeâ”‚
â”‚              â”‚              â”‚ + operatorId â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ CHECKED_OUT  â”‚
              â”‚              â”‚
              â”‚ + checkOutTime
              â”‚ + totalAmountâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Files Created vs Files to Modify

```
âœ… CREATED BY AI (No Action Needed):
â”œâ”€â”€ CheckInMode.kt
â”œâ”€â”€ CheckInRequest.kt (updated)
â”œâ”€â”€ OperatorViewModel.kt
â”œâ”€â”€ OperatorDashboardActivity.kt
â”œâ”€â”€ activity_operator_dashboard.xml
â””â”€â”€ Documentation files (*.md)

ğŸ”§ YOU NEED TO MODIFY:
â”œâ”€â”€ LoginActivity.kt          â†’ Add role-based navigation
â”œâ”€â”€ ApiService.kt             â†’ Add 2 operator endpoints
â”œâ”€â”€ BookingRepository.kt      â†’ Add 2 wrapper methods
â””â”€â”€ AndroidManifest.xml       â†’ Register OperatorDashboardActivity
```

---

## Testing Matrix

| Test Case | User Type | Action | Expected Result |
|-----------|-----------|--------|-----------------|
| TC-01 | USER | Login | Navigate to MainContainerActivity |
| TC-02 | OPERATOR | Login | Navigate to OperatorDashboardActivity |
| TC-03 | USER | Check-in with QR | POST to /{userId}/checkin/{bookingId} |
| TC-04 | OPERATOR | Scan plate "ABC123" | POST to /checkin with vehicleNumber |
| TC-05 | USER | Call operator endpoint | 403 Forbidden |
| TC-06 | OPERATOR | Call user endpoint | 403 Forbidden |
| TC-07 | OPERATOR | Scan invalid plate | 404 Not Found |
| TC-08 | USER | Scan wrong booking | 403 Not your booking |

---

**This architecture allows:**
- âœ… Role-based access control (RBAC)
- âœ… Separate UI/UX for different user types
- âœ… Secure endpoint protection via JWT
- âœ… Flexible check-in modes (QR, vehicle, PIN)
- âœ… Operator tracking (who checked in which vehicle)

